import"./vue.a928b16e.js";import{_ as O,a as S,c as A,i as M}from"./index.651dbde8.js";import{l as n}from"./lodash.5fa5cd01.js";import{u as N}from"./use-http.5643713b.js";import{r as c,M as j,w as E,aW as f,aR as w,ar as I,bd as P,P as m,c as T,aM as V}from"./@vue.a7cd1c69.js";import"./vue-router.49bf991f.js";import"./js-md5.216a9fc2.js";import"./@babel.7a426183.js";import"./regenerator-runtime.59ce731c.js";import"./spark-md5.2cc5764b.js";import"./axios.e3200588.js";import"./ant-design-vue.33297aa8.js";import"./@ant-design.8381fcec.js";import"./@ctrl.fa7cbd46.js";import"./resize-observer-polyfill.8deb1e21.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./lodash-es.8a2ffed6.js";import"./dayjs.060c2017.js";import"./async-validator.5d25c98b.js";import"./scroll-into-view-if-needed.5191fdbf.js";import"./compute-scroll-into-view.6058b3be.js";import"./js-cookie.31874410.js";/* empty css                     */import"./clipboard.76283100.js";const k={name:"ExForm",inheritAttrs:!1},D=Object.assign(k,{props:{url:String,method:{type:String,default:"POST"},exceptField:{type:Array,default:[]},editId:{type:[String,Number],default:null},callParams:{type:Object,default:{}},params:{type:Object,default:{}},tabsValidateField:{type:Array,default:[]},drawing:Boolean,stepCurrent:[String,Number]},emits:["success","formModalClose","gridRefresh","update:stepCurrent","watchModel"],setup(_,{expose:v,emit:a}){const r=_,i=c(),o=j(),h=S(),d=c(null),{loading:F,http:g}=N();E(o.model,e=>{a("watchModel",e)});function b(){const e=JSON.parse(JSON.stringify(o.model));return A(e,r.exceptField),e}function p(e){let s=e.map(t=>M(t)?"*":t);n.exports.forEach(r.tabsValidateField,function(t){n.exports.forEach(t,function(l,R){s.join(".")==R&&n.exports.forEach(l,function(u){h[u.model]=u.key})})}),i.value.scrollToField(e,{block:"center",behavior:"smooth"})}function y(e,s,t){e=e.join("."),s?(o.validateField[e].message=null,o.validateField[e].status=null):(o.validateField[e].status="error",o.validateField[e].message=t)}function C(){i.value.validate().then(()=>{r.url?g({url:r.url,method:r.method,data:Object.assign(r.callParams,{ex_admin_action:"save",data:b(),CURRENT_VALIDATION_STEP:r.stepCurrent,FORM_REF:o.form_ref,id:r.editId},r.params)}).then(e=>{if(e.code===422){let s="";for(let t in e.data){s||(s=t);let l=e.data[t];o.validateField[t].status="error",o.validateField[t].message=Array.isArray(l)?l[0]:l}p([s]);return}else if(e.code===201){a("update:stepCurrent",r.stepCurrent+1);return}else e.code===202&&(a("update:stepCurrent",r.stepCurrent+1),d.value=e.data);a("success",e),a("gridRefresh"),a("formModalClose")}):(a("success"),a("gridRefresh"),a("formModalClose"))}).catch(e=>{p(e.errorFields[0].name)})}function x(){a("update:stepCurrent",0),i.value.resetFields(),d.value=null}return v({stepReset:x,form:i,loading:F,submit:C}),(e,s)=>{const t=f("render"),l=f("a-form");return w(),I(l,V({class:"form",ref_key:"form",ref:i,onValidate:y},e.$attrs),{default:P(()=>[m(e.$slots,"default",{},void 0,!0),T(t,{data:d.value},null,8,["data"]),m(e.$slots,"footer",{},void 0,!0)]),_:3},16)}}});var pe=O(D,[["__scopeId","data-v-108b152c"]]);export{pe as default};
