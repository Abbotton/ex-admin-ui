import"./vue.a928b16e.js";import{S as T}from"./sortablejs.412b554c.js";import{_ as j,a as M,c as k,f as I,g as D,h as P,i as $,j as v,k as q,l as U}from"./index.0f55eb16.js";import{l as d}from"./lodash.a1aa704a.js";import{u as V}from"./use-http.97b58585.js";import{r as h,M as B,w as H,j as L,n as J,a as W,aW as y,aR as z,at as G,c as b,bd as K,P as F,u as Q,aM as X}from"./@vue.a7cd1c69.js";import"./vue-router.49bf991f.js";import"./js-md5.911d3a00.js";import"./@babel.2e32324c.js";import"./regenerator-runtime.8e24db72.js";import"./spark-md5.2cc5764b.js";import"./axios.e3200588.js";import"./ant-design-vue.d3bb1542.js";import"./@ant-design.8381fcec.js";import"./@ctrl.fa7cbd46.js";import"./resize-observer-polyfill.8deb1e21.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./lodash-es.8a2ffed6.js";import"./dayjs.b753ae88.js";import"./async-validator.5d25c98b.js";import"./scroll-into-view-if-needed.5191fdbf.js";import"./compute-scroll-into-view.6058b3be.js";import"./js-cookie.31874410.js";/* empty css                     */import"./clipboard.0f95154e.js";const Y={class:"form"},Z={name:"ExForm",inheritAttrs:!1},ee=Object.assign(Z,{props:{url:String,method:{type:String,default:"POST"},exceptField:{type:Array,default:[]},editId:{type:[String,Number],default:null},callParams:{type:Object,default:{}},tabsValidateField:{type:Array,default:[]},drawing:Boolean,stepCurrent:[String,Number]},emits:["success","dragUpdate","formModalClose","gridRefresh","update:stepCurrent"],setup(A,{expose:x,emit:s}){const o=A,i=h(),n=B(),C=M(),u=h(null),{loading:E,http:S}=V();function w(){const e=JSON.parse(JSON.stringify(n.model));return m(e),e}let c=null;H(n.model,e=>{q()}),L(()=>{o.drawing&&f()}),o.drawing&&J(()=>{c=T.create(i.value.$el,{handle:".ant-form-item",group:"draggable",animation:300,onAdd:function(e){k(e),e.item.remove()},onChoose:function(e){I(e.oldIndex),p()},onEnd:function(e){D(e)}}),f()});function f(){p(),i.value.$el.querySelectorAll(".ant-form-item").forEach((e,a)=>{e.onmouseover=function(r){if(e.querySelectorAll(".drawing-item-delete").length==0){let t=document.createElement("span");t.className="drawing-item-copy",t.innerHTML='<i class="far fa-copy"></i>',t.onclick=function(l){P(a),l.preventDefault()},e.append(t),t=document.createElement("span"),t.className="drawing-item-delete",t.innerHTML='<i class="far fa-trash-alt"></i>',t.onclick=function(l){$(a),l.preventDefault()},e.append(t)}},e.onmouseleave=function(r){document.querySelectorAll(".drawing-item-copy").forEach(t=>{t.remove()}),document.querySelectorAll(".drawing-item-delete").forEach(t=>{t.remove()})},e.setAttribute("data-draggable",!0)})}function p(){let e;i.value.$el.querySelectorAll(".ant-form-item").forEach((a,r)=>{v.index===r&&(e=a),a.removeAttribute("data-choose")}),e&&e.setAttribute("data-choose",!0)}W(()=>{c&&c.destroy()});function m(e){d.exports.forEach(e,function(a,r){o.exceptField.indexOf(r)>-1?delete e[r]:Array.isArray(a)&&d.exports.forEach(a,function(t){m(t)})})}function g(e){let a=e.map(r=>U(r)?"*":r);d.exports.forEach(o.tabsValidateField,function(r){d.exports.forEach(r,function(t,l){a.join(".")==l&&d.exports.forEach(t,function(_){C[_.model]=_.key})})}),i.value.scrollToField(e,{block:"center",behavior:"smooth"})}function R(e,a,r){e=e.join("."),a?(n.validateField[e].message=null,n.validateField[e].status=null):(n.validateField[e].status="error",n.validateField[e].message=r)}function N(){i.value.validate().then(()=>{o.url?S({url:o.url,method:o.method,data:Object.assign(o.callParams,{ex_admin_action:"save",data:w(),CURRENT_VALIDATION_STEP:o.stepCurrent,FORM_REF:n.form_ref,id:o.editId})}).then(e=>{if(e.code===422){let a="";for(let r in e.data){a||(a=r);let t=e.data[r];n.validateField[r].status="error",n.validateField[r].message=Array.isArray(t)?t[0]:t}g([a]);return}else if(e.code===201){s("update:stepCurrent",o.stepCurrent+1);return}else e.code===202&&(s("update:stepCurrent",o.stepCurrent+1),u.value=e.data);s("success",e),s("gridRefresh"),s("formModalClose")}):(s("success"),s("gridRefresh"),s("formModalClose"))}).catch(e=>{g(e.errorFields[0].name)})}function O(){s("update:stepCurrent",0),i.value.resetFields(),u.value=null}return x({stepReset:O,form:i,loading:E,submit:N}),(e,a)=>{const r=y("render"),t=y("a-form");return z(),G("div",Y,[b(t,X({ref_key:"form",ref:i,onValidate:R},e.$attrs),{default:K(()=>[F(e.$slots,"default",{drawing:Q(v)},void 0,!0),b(r,{data:u.value},null,8,["data"]),F(e.$slots,"footer",{},void 0,!0)]),_:3},16)])}}});var we=j(ee,[["__scopeId","data-v-5eb26746"]]);export{we as default};
