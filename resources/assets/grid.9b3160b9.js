import"./vue.a928b16e.js";import{S as rt}from"./sortablejs.412b554c.js";import{u as dt}from"./use-http.5643713b.js";import{_ as st,u as ut,a as ct,s as q,t as p,e as mt,d as ft}from"./index.651dbde8.js";import{l as xe}from"./lodash.5fa5cd01.js";import{g as pt,M as ht,f as vt,r as g,w as yt,m as ke,N as gt,n as Se,a as bt,aW as u,aR as d,ar as c,bd as a,c as r,as as h,at as k,u as l,I as C,ai as S,F as z,aV as W,au as ie,G as _t,af as we,z as xt,E as kt,aM as re,ay as Ce,aX as Ae,ah as St}from"./@vue.a7cd1c69.js";import{M as de,m as wt}from"./ant-design-vue.33297aa8.js";import"./vue-router.49bf991f.js";import"./js-md5.216a9fc2.js";import"./@babel.7a426183.js";import"./regenerator-runtime.59ce731c.js";import"./spark-md5.2cc5764b.js";import"./axios.e3200588.js";import"./js-cookie.31874410.js";import"./@ant-design.8381fcec.js";import"./@ctrl.fa7cbd46.js";/* empty css                     */import"./dayjs.060c2017.js";import"./clipboard.76283100.js";import"./resize-observer-polyfill.8deb1e21.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./lodash-es.8a2ffed6.js";import"./async-validator.5d25c98b.js";import"./scroll-into-view-if-needed.5191fdbf.js";import"./compute-scroll-into-view.6058b3be.js";const Ct={key:0,style:{width:"8px"}},At={class:"right"},Bt={key:1,class:"filter"},Et={key:0,class:"custom-action"},It={key:0,class:"sortDrag"},Gt={style:{"text-align":"center"}},Ft={style:{"margin-top":"10px"}},Ot={key:0},qt={key:1,style:{color:"red"}},Tt={inheritAttrs:!1,name:"ExGrid"},Dt=Object.assign(Tt,{props:{pagination:Object,dataSource:Array,columns:Array,hidePage:Boolean,quickSearchText:String,addButton:[Object,Boolean],quickSearch:Boolean,hideDeleteSelection:Boolean,hideAdd:Boolean,hideDelete:Boolean,hideTrashedDelete:Boolean,hideTrashedRestore:Boolean,hideFilter:Boolean,hideSelection:Boolean,expandFilter:Boolean,hideTools:Boolean,hideExport:Boolean,queueExport:Boolean,hideExportCurrentPage:Boolean,hideExportSelection:Boolean,hideExportAll:Boolean,hideTrashed:Boolean,sidebar:Object,selectedSidebar:[String,Number],selection:{type:Array,default:[]},selectionField:String,selectionLimit:{type:Number,default:0},selectionType:{type:String,default:"checkbox"},filter:[Object,Boolean],header:[Object,Boolean],footer:[Object,Boolean],tools:[Object,Boolean],url:String,custom:[Object,Boolean],params:{type:Object,default:{}},callParams:{type:Object,default:{}}},emits:["update:selection","update:selectedSidebar","update:expandFilter"],setup(i,{expose:Be,emit:L}){const s=i;ut(pt());const M=ct();let X=null,K={};const{loading:se,http:Ee}=dt(),_=ht(),y=vt({visible:!1,status:"",percent:0,timer:null,url:""}),J=g(s.header),Q=g(s.footer),ue=g(s.tools),Y=g(s.addButton),b=g(s.dataSource),Z=g(""),I=g(1),$=g(s.pagination.attribute.defaultPageSize),ee=g(s.pagination.attribute.total),A=g(!1),x=g(s.selection),ce=g([]),D=g(s.columns),me=g(!1),U=g(s.columns.map(e=>e.dataIndex)),P=g();yt(P,e=>{L("update:selectedSidebar",e),w()});const N=g(),fe=ke(()=>D.value.filter(e=>(U.value.indexOf(e.dataIndex)>=0||e.dataIndex=="ExAdminAction")&&!e.hide));gt(()=>{D.value=[],U.value=s.columns.map(e=>e.dataIndex),setTimeout(()=>{D.value=s.columns})});function j(e,t){pe(x,_.rowKey,e,t),pe(ce,s.selectionField||_.rowKey,e,t),L("update:selection",ce.value)}function pe(e,t,n,m){const f=m.map(v=>v[t]);n?s.selectionType==="checkbox"?(e.value=xe.exports.uniq(e.value.concat(f)),s.selectionLimit>0&&(e.value=e.value.slice(0,s.selectionLimit))):e.value=f:f.map(v=>{ft(e.value,v)})}const Ie=ke(()=>s.hideSelection?null:{selectedRowKeys:l(x),type:s.selectionType,onSelect:(e,t,n,m)=>{t?j(t,n):j(t,[e])},onSelectAll:(e,t,n)=>{e?j(e,t):j(e,n)}});function Ge(e){w()}function Fe(){I.value=1,w()}function Oe(){de.confirm({title:p("Grid.continue"),content:p("Grid.confirmClear"),onOk(){q({url:s.url,method:"delete",data:G({ex_admin_action:"deleteAll"})}).then(e=>{x.value=[],w()})}})}function qe(){de.confirm({title:p("Grid.continue"),content:p("Grid.confirmClearSelected"),onOk(){q({url:s.url,method:"post",data:G({ex_admin_action:"delete",ids:x.value})}).then(e=>{x.value=[],w()})}})}function Te(){de.confirm({title:p("Grid.continue"),content:p("Grid.confirmRecoverySelected"),onOk(){q({url:s.url,method:"post",data:G({ex_admin_action:"restore",ids:x.value})}).then(e=>{x.value=[],w()})}})}function G(e){let t={_ajax:"get"};return A.value&&Object.assign(t,{ex_admin_trashed:!0}),Object.assign(t,s.callParams,e),P.value&&(t[s.sidebar.attribute.field]=P.value),t}function he(){let e={grid_request_data:!0,ex_admin_page:I.value,ex_admin_size:$.value,quickSearch:Z.value},t={};return s.filter&&(t=M[s.filter.bindAttribute.model]),Object.assign(e,s.params,K,t),e}function w(){Ee({url:s.url,method:"post",data:G(he())}).then(e=>{b.value=e.data,ee.value=e.total,J.value=e.header,Q.value=e.footer,ue.value=e.tools,Y.value=e.addButton,Se(()=>{ve()})})}Se(()=>{s.custom||(Pe(),ve())}),bt(e=>{X&&X.destroy(),V()});function ve(){const e=N.value.table.$el;D.value.forEach(t=>{if(t.dataIndex==="ExAdminAction"&&!t.width){let n=0,m=e.getElementsByClassName("ExAdminAction");if(m.length>0&&(m=Array.from(m),m.forEach(f=>{let v=f.offsetWidth;n<v&&(n=v)}),t.width=n+40),!t.fixed){const f=ye(),v=e.querySelectorAll(`.${f}`)[0];e.querySelectorAll(`.${f} > table`)[0].clientWidth>v.clientWidth&&(t.fixed="right")}}})}function De(){L("update:expandFilter",!s.expandFilter)}function ye(){return _.scroll.y?"ant-table-body":"ant-table-content"}function Pe(){if(N.value){let e=N.value.table.$el,t;const n=ye();e=e.querySelectorAll(`.${n} > table > tbody`)[0],e.getElementsByClassName("sortHandel").length&&(t=e.getElementsByClassName("sortHandel")[0].dataset.field),X=rt.create(e,{animation:1e3,handle:".sortHandel",onEnd:m=>{var f=m.newIndex-1,v=m.oldIndex-1,F=b.value[v],H=(I.value-1)*$.value;const ae=b.value.splice(v,1)[0];b.value.splice(f,0,ae),v!=f&&te(F[_.rowKey],H+f,t).catch(()=>{const le=b.value.splice(f,1)[0];b.value.splice(v,0,le)})}})}}const je=xe.exports.debounce(Re,300);function Re(e,t,n){q({url:s.url,method:"post",data:G({ex_admin_action:"inputSort",id:e,field:n,sort:parseInt(t)})})}function ze(e,t,n){te(t,0,n).then(m=>{if(I.value===1){const f=b.value.splice(e,1)[0];b.value.unshift(f)}else b.value.splice(e,1)})}function Ke(e,t,n){te(t,ee.value-1,n).then(m=>{if(I.value===1){const f=b.value.splice(e,1)[0];b.value.push(f)}else b.value.splice(e,1)})}function te(e,t,n){return new Promise((m,f)=>{q({url:s.url,method:"post",data:G({ex_admin_action:"dragSort",id:e,field:n,sort:t})}).then(v=>{m(v)}).catch(v=>{f(v)})})}function $e(e,t,n){n.order==="descend"?K={ex_admin_sort_field:n.field,ex_admin_sort_by:"desc"}:n.order==="ascend"?K={ex_admin_sort_field:n.field,ex_admin_sort_by:"asc"}:K={},w()}function Ue({key:e}){if(b.value.length==0)return wt.warning(p("Grid.empty")),!1;let t=!1,n=[];e=="all"?t=!0:e=="select"?n=x.value:e=="page"&&(n=b.value.map(m=>m[_.rowKey])),q({url:s.url,method:"post",data:G(Object.assign(he(),{ex_admin_action:"export",ex_admin_export:!0,columns:fe.value.filter(m=>!(m.dataIndex==="ExAdminAction"||m.closeExport)),selectIds:n,all:t,ex_admin_queue:s.queueExport}))}).then(m=>{y.status="",y.percent=0,y.visible=!0,y.timer=setInterval(()=>{q({url:"/ex-admin/system/exportProgress",method:"post",data:{key:m.data.key}}).then(f=>{f.data.status==0?y.percent=f.data.progress:f.data.status==1?(y.status="success",y.percent=100,y.url=f.data.url,V()):f.data.status==2&&(y.status="exception",V())})},500)})}function Ne(e){e()}function Ve(){A.value=!A.value,w()}function V(){y.timer!=null&&clearInterval(y.timer)}return Be({requestData:w,selectIds:x}),(e,t)=>{const n=u("render"),m=u("a-col"),f=u("search-outlined"),v=u("a-input-search"),F=u("a-menu-item"),H=u("a-menu"),ae=u("download-outlined"),le=u("DownOutlined"),B=u("a-button"),ge=u("a-dropdown"),ne=u("delete-outlined"),He=u("diff-outlined"),We=u("SearchOutlined"),R=u("a-tooltip"),be=u("appstore-filled"),Le=u("reload-outlined"),Me=u("a-checkbox"),Xe=u("a-checkbox-group"),_e=u("a-row"),Je=u("a-list-item"),Qe=u("a-list"),Ye=u("filter-filled"),Ze=u("caret-up-outlined"),et=u("drag-outlined"),tt=u("caret-down-outlined"),at=u("a-input"),lt=u("a-table"),nt=u("a-progress"),ot=u("a-typography-link"),it=u("a-modal");return d(),c(_e,re(e.$attrs,{gutter:10,style:l(_).scroll.y?"height:"+l(_).scroll.y+"px":""}),{default:a(()=>[i.sidebar?(d(),c(m,{key:0,span:5,style:{height:"100%"}},{default:a(()=>[r(n,{data:i.sidebar,value:P.value,"onUpdate:value":t[0]||(t[0]=o=>P.value=o)},null,8,["data","value"])]),_:1})):h("",!0),r(m,{span:i.sidebar?19:24,style:{height:"100%"}},{default:a(()=>[i.hideTools?h("",!0):(d(),k("div",{key:0,class:we(["tools",i.custom&&i.custom.attribute.customStyle!="card"?"custom":""])},[r(_e,null,{default:a(()=>[i.quickSearch?(d(),c(m,{key:0,span:5},{default:a(()=>[r(v,{allowClear:"","enter-button":l(p)("Grid.search"),value:Z.value,"onUpdate:value":t[1]||(t[1]=o=>Z.value=o),placeholder:i.quickSearchText||l(p)("Grid.quickSearchText"),onSearch:Fe},{prefix:a(()=>[r(f,{style:{color:"#c0c4cc"}})]),_:1},8,["enter-button","value","placeholder"])]),_:1})):h("",!0),r(m,{span:i.quickSearch?15:20,style:{display:"flex"}},{default:a(()=>[i.quickSearch?(d(),k("div",Ct)):h("",!0),Y.value&&!i.hideAdd?(d(),c(n,{key:1,data:Y.value},null,8,["data"])):h("",!0),i.hideExport?h("",!0):(d(),c(ge,{key:2,trigger:["click"]},{overlay:a(()=>[r(H,{onClick:Ue},{default:a(()=>[i.hideExportCurrentPage?h("",!0):(d(),c(F,{key:"page"},{default:a(()=>[C(S(l(p)("Grid.exportPage")),1)]),_:1})),i.hideExportSelection?h("",!0):(d(),c(F,{key:"select",disabled:x.value.length===0},{default:a(()=>[C(S(l(p)("Grid.exportSelect")),1)]),_:1},8,["disabled"])),i.hideExportAll?h("",!0):(d(),c(F,{key:"all"},{default:a(()=>[C(S(l(p)("Grid.exportAll")),1)]),_:1}))]),_:1})]),default:a(()=>[r(B,{type:"primary"},{icon:a(()=>[r(ae)]),default:a(()=>[C(" "+S(l(p)("Grid.export"))+" ",1),r(le)]),_:1})]),_:1})),!i.hideDeleteSelection&&x.value.length>0&&!A.value?(d(),c(B,{key:3,onClick:qe},{icon:a(()=>[r(ne)]),default:a(()=>[C(" "+S(l(p)("Grid.deleteSelected")),1)]),_:1})):h("",!0),!i.hideTrashedRestore&&x.value.length>0&&A.value?(d(),c(B,{key:4,onClick:Te},{icon:a(()=>[r(He)]),default:a(()=>[C(" "+S(l(p)("Grid.restoreSelected")),1)]),_:1})):h("",!0),!i.hideDelete&&!(A.value&&i.hideTrashedDelete)?(d(),c(B,{key:5,onClick:Oe,type:"primary",danger:""},{icon:a(()=>[r(ne)]),default:a(()=>[C(" "+S(l(p)("Grid.clearData")),1)]),_:1})):h("",!0),(d(!0),k(z,null,W(ue.value,o=>(d(),c(n,{data:o},null,8,["data"]))),256))]),_:1},8,["span"]),r(m,{span:4},{default:a(()=>[ie("div",At,[i.filter&&!i.hideFilter?(d(),c(R,{key:0,title:i.expandFilter?l(p)("Grid.collapseFilter"):l(p)("Grid.expandFilter")},{default:a(()=>[r(B,{shape:"circle",size:"small",onClick:De},{icon:a(()=>[r(We)]),_:1})]),_:1},8,["title"])):h("",!0),i.hideTrashed?h("",!0):(d(),c(R,{key:1,title:A.value?l(p)("Grid.dataList"):l(p)("Grid.recycle")},{default:a(()=>[r(B,{shape:"circle",size:"small",onClick:Ve},{icon:a(()=>[A.value?(d(),c(be,{key:0})):(d(),c(ne,{key:1}))]),_:1})]),_:1},8,["title"])),r(B,{shape:"circle",size:"small",onClick:w},{icon:a(()=>[r(Le)]),_:1}),i.custom?h("",!0):(d(),c(ge,{key:2,visible:me.value,"onUpdate:visible":t[4]||(t[4]=o=>me.value=o)},{overlay:a(()=>[r(H,null,{default:a(()=>[r(Xe,{value:U.value,"onUpdate:value":t[3]||(t[3]=o=>U.value=o)},{default:a(()=>[(d(!0),k(z,null,W(D.value,o=>(d(),k(z,null,[o.title&&!o.hide?(d(),c(F,{key:0},{default:a(()=>[r(Me,{value:o.dataIndex},{default:a(()=>[C(S(o.title),1)]),_:2},1032,["value"])]),_:2},1024)):h("",!0)],64))),256))]),_:1},8,["value"])]),_:1})]),default:a(()=>[r(B,{shape:"circle",size:"small",onClick:t[2]||(t[2]=_t(()=>{},["prevent"]))},{icon:a(()=>[r(be)]),_:1})]),_:1},8,["visible"]))])]),_:1})]),_:1})],2)),i.filter?xt((d(),k("div",Bt,[r(n,{data:i.filter},null,8,["data"])],512)),[[kt,i.expandFilter&&!i.hideFilter]]):h("",!0),i.custom?(d(),c(Qe,re({key:2,"data-source":b.value,loading:l(se)},i.custom.attribute,{"row-key":l(_).rowKey,class:"scrollbar",style:l(_).scroll.y?"height:"+(l(_).scroll.y-65)+"px":""}),Ce({renderItem:a(({item:o,index:O})=>[r(Je,null,{default:a(()=>[(d(),c(Ae(i.custom.attribute.container),null,{default:a(()=>[r(n,{data:o.custom},null,8,["data"]),o.ExAdminAction?(d(),k("div",Et,[i.hideSelection?h("",!0):(d(),c(Ae(i.selectionType=="checkbox"?"ACheckbox":"ARadio"),{key:0,checked:x.value.indexOf(o[l(_).rowKey])>-1,onChange:E=>j(E.target.checked,[o])},null,8,["checked","onChange"])),o.ExAdminAction?(d(),c(n,{key:1,data:o.ExAdminAction},null,8,["data"])):h("",!0)])):h("",!0)]),_:2},1024))]),_:2},1024)]),_:2},[i.custom.attribute.header?{name:"header",fn:a(()=>[r(n,{data:i.custom.attribute.header},null,8,["data"])])}:void 0,i.custom.attribute.footer?{name:"footer",fn:a(()=>[r(n,{data:i.custom.attribute.footer},null,8,["data"])])}:void 0]),1040,["data-source","loading","row-key","style"])):(d(),c(lt,re({key:3},e.$attrs,{"row-selection":l(Ie),dataSource:b.value,columns:l(fe),pagination:!1,loading:l(se),onChange:$e,ref_key:"dragTable",ref:N}),Ce({headerCell:a(({column:o})=>[r(n,{data:o.header},null,8,["data"])]),customFilterDropdown:a(({setSelectedKeys:o,selectedKeys:O,confirm:E,clearFilters:oe,column:T})=>[r(n,{data:T.customFilterForm,context:l(M),onSuccess:Pt=>Ne(E)},null,8,["data","context","onSuccess"])]),customFilterIcon:a(({filtered:o,column:O})=>[r(Ye,{style:St({color:l(mt)(l(M)[i.filter.bindAttribute.model][O.dataIndex])?void 0:"#108ee9"})},null,8,["style"])]),bodyCell:a(({column:o,record:O,text:E,index:oe})=>[o.type=="sortDrag"?(d(),k("div",It,[r(R,{placement:"right",title:l(p)("Grid.sortTop")},{default:a(()=>[r(Ze,{style:{cursor:"pointer"},onClick:T=>ze(oe,O[l(_).rowKey],o.dataIndex)},null,8,["onClick"])]),_:2},1032,["title"]),r(R,{placement:"right",title:l(p)("Grid.sortDrag")},{default:a(()=>[r(et,{class:"sortHandel","data-field":o.dataIndex,style:{"font-weight":"bold",cursor:"grab"}},null,8,["data-field"])]),_:2},1032,["title"]),r(R,{placement:"right",title:l(p)("Grid.sortBottom")},{default:a(()=>[r(tt,{style:{cursor:"pointer"},onClick:T=>Ke(oe,O[l(_).rowKey],o.dataIndex)},null,8,["onClick"])]),_:2},1032,["title"])])):o.type=="sortInput"?(d(),c(at,{key:1,value:E.content.default[0],"onUpdate:value":T=>E.content.default[0]=T,onChange:T=>l(je)(O[l(_).rowKey],E.content.default[0],o.dataIndex)},null,8,["value","onUpdate:value","onChange"])):(d(),c(n,{key:2,data:E},null,8,["data"]))]),_:2},[J.value?{name:"title",fn:a(()=>[(d(!0),k(z,null,W(J.value,o=>(d(),c(n,{data:o},null,8,["data"]))),256))])}:void 0,e.$attrs.expandedRow?{name:"expandedRowRender",fn:a(({record:o})=>[r(n,{data:o.ExAdminExpandRow,"slot-props":e.grid},null,8,["data","slot-props"])])}:void 0,Q.value?{name:"footer",fn:a(()=>[(d(!0),k(z,null,W(Q.value,o=>(d(),c(n,{data:o},null,8,["data"]))),256))])}:void 0]),1040,["row-selection","dataSource","columns","loading"])),i.hidePage?h("",!0):(d(),c(n,{key:4,class:we(["pagination",i.custom&&i.custom.attribute.customStyle!="card"?"custom":""]),data:i.pagination,current:I.value,"onUpdate:current":t[5]||(t[5]=o=>I.value=o),pageSize:$.value,"onUpdate:pageSize":t[6]||(t[6]=o=>$.value=o),total:ee.value,onChange:Ge},null,8,["class","data","current","pageSize","total"])),r(it,{afterClose:V,maskClosable:!1,keyboard:!1,footer:null,visible:l(y).visible,"onUpdate:visible":t[7]||(t[7]=o=>l(y).visible=o),title:l(p)("Grid.exportProgress")},{default:a(()=>[ie("div",Gt,[r(nt,{type:"circle",percent:l(y).percent,status:l(y).status},null,8,["percent","status"]),ie("div",Ft,[l(y).status=="success"?(d(),k("div",Ot,[C(S(l(p)("Grid.exportSuccess"))+" ",1),r(ot,{href:l(y).url,target:"_blank"},{default:a(()=>[C(S(l(p)("Grid.download")),1)]),_:1},8,["href"])])):l(y).status=="exception"?(d(),k("div",qt,S(l(p)("Grid.exportFail")),1)):h("",!0)])])]),_:1},8,["visible","title"])]),_:1},8,["span"])]),_:1},16,["style"])}}});var sa=st(Dt,[["__scopeId","data-v-4b9adcb4"]]);export{sa as default};
