import"./vue.f169bc0e.js";import{_ as O,a as S,i as N}from"./index.5f1a6ec5.js";import{l as n}from"./lodash.a1aa704a.js";import{u as j}from"./use-http.eb9cc702.js";import{r as c,M as I,Y as m,Z as P,a0 as T,c as _,$ as M,P as v,ab as V}from"./@vue.a2bdcbc4.js";import"./vue-router.0de480eb.js";import"./js-md5.911d3a00.js";import"./@babel.2e32324c.js";import"./regenerator-runtime.8e24db72.js";import"./spark-md5.2cc5764b.js";import"./axios.e3200588.js";import"./ant-design-vue.0a51b2ba.js";import"./@ant-design.594a5492.js";import"./@ctrl.fa7cbd46.js";import"./resize-observer-polyfill.8deb1e21.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./lodash-es.8a2ffed6.js";import"./dayjs.b753ae88.js";import"./async-validator.5d25c98b.js";import"./scroll-into-view-if-needed.5191fdbf.js";import"./compute-scroll-into-view.6058b3be.js";import"./js-cookie.31874410.js";/* empty css                     */import"./clipboard.0f95154e.js";const D={class:"form"},$={name:"ExForm",inheritAttrs:!1},k=Object.assign($,{props:{url:String,method:{type:String,default:"POST"},exceptField:{type:Array,default:[]},editId:{type:[String,Number],default:null},callParams:{type:Object,default:{}},tabsValidateField:{type:Array,default:[]},stepCurrent:[String,Number]},emits:["success","formModalClose","gridRefresh","update:stepCurrent"],setup(h,{expose:F,emit:a}){const o=h,l=c(),i=I(),g=S(),d=c(null),{loading:x,http:y}=j();function C(){const e=JSON.parse(JSON.stringify(i.model));return p(e),e}function p(e){n.exports.forEach(e,function(r,t){o.exceptField.indexOf(t)>-1?delete e[t]:Array.isArray(r)&&n.exports.forEach(r,function(s){p(s)})})}function u(e){let r=e.map(t=>N(t)?"*":t);n.exports.forEach(o.tabsValidateField,function(t){n.exports.forEach(t,function(s,R){r.join(".")==R&&n.exports.forEach(s,function(f){g[f.model]=f.key})})}),l.value.scrollToField(e,{block:"center",behavior:"smooth"})}function b(e,r,t){e=e.join("."),r?(i.validateField[e].message=null,i.validateField[e].status=null):(i.validateField[e].status="error",i.validateField[e].message=t)}function A(){l.value.validate().then(()=>{o.url?y({url:o.url,method:o.method,data:Object.assign(o.callParams,{ex_admin_action:"save",data:C(),CURRENT_VALIDATION_STEP:o.stepCurrent,FORM_REF:i.form_ref,id:o.editId})}).then(e=>{if(e.code===422){let r="";for(let t in e.data){r||(r=t);let s=e.data[t];i.validateField[t].status="error",i.validateField[t].message=Array.isArray(s)?s[0]:s}u([r]);return}else if(e.code===201){a("update:stepCurrent",o.stepCurrent+1);return}else e.code===202&&(a("update:stepCurrent",o.stepCurrent+1),d.value=e.data);a("success",e),a("gridRefresh"),a("formModalClose")}):(a("success"),a("gridRefresh"),a("formModalClose"))}).catch(e=>{u(e.errorFields[0].name)})}function E(){a("update:stepCurrent",0),l.value.resetFields(),d.value=null}return F({stepReset:E,form:l,loading:x,submit:A}),(e,r)=>{const t=m("render"),s=m("a-form");return P(),T("div",D,[_(s,V({ref_key:"form",ref:l,onValidate:b},e.$attrs),{default:M(()=>[v(e.$slots,"default",{},void 0,!0),_(t,{data:d.value},null,8,["data"]),v(e.$slots,"footer",{},void 0,!0)]),_:3},16)])}}});var pe=O(k,[["__scopeId","data-v-b6719264"]]);export{pe as default};
