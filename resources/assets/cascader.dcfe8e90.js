var S=Object.defineProperty;var D=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var g=(a,t,i)=>t in a?S(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,F=(a,t)=>{for(var i in t||(t={}))B.call(t,i)&&g(a,i,t[i]);if(D)for(var i of D(t))N.call(t,i)&&g(a,i,t[i]);return a};import"./vue.4c5758a0.js";import{d as f}from"./@vueuse.67682d36.js";import{C as P,c as j,f as k,G as I}from"./index.7bd81452.js";import{l as h}from"./lodash.28c974ad.js";import{u as T}from"./remoteOptions.92547769.js";import{F as $,a as q}from"./ant-design-vue.e954adc4.js";import{d as G,h as M}from"./@vue.87afd1fa.js";import"./@babel.dd651e2b.js";import"./regenerator-runtime.8e24db72.js";import"./vue-demi.24ed2461.js";import"./js-md5.3cdd41c4.js";import"./vue-router.9a2c52dc.js";import"./js-cookie.31874410.js";import"./spark-md5.2cc5764b.js";import"./axios.e3200588.js";import"./@ant-design.8c82b126.js";import"./@ctrl.fa7cbd46.js";/* empty css                     */import"./dayjs.0743a87f.js";import"./sortablejs.412b554c.js";import"./clipboard.89482ba1.js";import"./markdown-it.39ce48f9.js";import"./entities.0d2c0164.js";import"./uc.micro.981ceb7b.js";import"./mdurl.ef76b4dc.js";import"./linkify-it.92c30060.js";import"./markdown-it-emoji.e3e91710.js";import"./escape-html.e5dfadb9.js";import"./prismjs.169105cf.js";import"./diacritics.6be19c75.js";import"./markdown-it-container.512a5043.js";import"./markdown-it-anchor.c88e5394.js";import"./markdown-it-attrs.3af5ab50.js";import"./markdown-it-table-of-contents.8a4ce16f.js";import"./@kangc.52338b19.js";import"./resize-observer-polyfill.8deb1e21.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./lodash-es.0ea26897.js";import"./async-validator.5d25c98b.js";import"./scroll-into-view-if-needed.5191fdbf.js";import"./compute-scroll-into-view.6058b3be.js";var Se=G({name:"ExCascader",props:{value:[String,Number,Array],options:Array,remote:Object,loadRemote:Object,cascaderValue:{type:Array,default:[]},single:Boolean,alwayLoad:Boolean},setup(a,t){const i=$.useInjectFormItemContext(),s=f(a,"value",t.emit),u=f(a,"options",t.emit),{remoteOptionsDebounce:w,remoteOptions:m}=T(a,u),n=t.attrs.fieldNames||{label:"label",value:"value",children:"children",pid:"pid"},p=f(a,"cascaderValue",t.emit);let c=P();function E(e){if(e===void 0)s.value=t.attrs.multiple?[]:null;else{let o=h.exports.cloneDeep(e);t.attrs.multiple?s.value=L(o):s.value=o.pop()}i.onFieldChange()}v();function v(){a.single?m(s.value).then(e=>{a.loadRemote?V():p.value=A(s.value)}):m().then(()=>{a.loadRemote&&V()})}function V(){const e=h.exports.cloneDeep(p.value);t.attrs.multiple?e.forEach(o=>{d(o,u.value)}):d(e,u.value)}async function d(e,o,r=null){let l=[...e];for(const O of e){let C=j(o,n.value,O,-1,n.children);if(C)r=C,l.shift();else if(r&&(o=await y(r),o)){d(l,o,r);break}}}function L(e){let o=[];return e.forEach(r=>{const l=r.pop();t.attrs.changeOnSelect?o.push(l):o=o.concat(R(l))}),h.exports.uniq(o)}function R(e){const o=[e],r=j(a.options,n.value,e,-1,n.children);if(r&&r[n.children])r[n.children].forEach(l=>{b(l,o)});else return[e];return o}function b(e,o=[]){return o.push(e[n.value]),e[n.children]&&e[n.children].forEach(r=>{b(r,o)}),o}function y(e){return new Promise(o=>{if(!e.hasOwnProperty("loading")||a.alwayLoad){e.loading=!0;let r=F({},a.loadRemote);r.data.search=e[n.value],c&&(r.data.data=c.submitData()),k(r).then(l=>{e.loading=!1,e[n.children]=l.data,u.value=[...u.value],o(l.data)})}else o()})}function A(e){Array.isArray(e)||(e?e=[e]:e=[]);const o=[];return e.forEach(r=>{o.push(I(u.value,r,n.value,n.pid,n.children).map(l=>l[n.value]))}),!t.attrs.multiple&&!t.attrs.changeOnSelect?o.pop():o}return{options:u,form:c,loadOptions:y,remoteOptionsDebounce:w,setupLoadOptions:v,remoteOptions:m,cascaderValue:p,fieldNames:n,updateValue:E}},render(a){let t=Object.assign({options:this.options},a.$attrs,{value:a.cascaderValue,"onUpdate:value":i=>{a.cascaderValue=i,this.updateValue(i)}});return this.remote&&(t.onSearch=i=>{this.remoteOptionsDebounce(i)},t.onDropdownVisibleChange=i=>{i&&this.setupLoadOptions()}),this.loadRemote&&(t.loadData=i=>{const s=i[i.length-1];this.loadOptions(s)}),M(q,t,a.$slots)}});export{Se as default};
