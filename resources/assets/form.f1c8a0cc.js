import"./vue.ba0abfb8.js";import{_ as O,a as S,c as A,i as N}from"./index.87ae8e72.js";import{l as n}from"./lodash.c9cf1bdb.js";import{u as j}from"./use-http.b670e2a1.js";import{r as c,U as E,w as M,aW as f,aR as w,ar as I,bd as T,W as _,c as P,aM as V}from"./@vue.cfb5b4bf.js";import"./vue-router.49809928.js";import"./@vueuse.dbb03eba.js";import"./vue-demi.a71c3140.js";import"./js-md5.5179c6be.js";import"./@babel.6cd0804c.js";import"./regenerator-runtime.8e24db72.js";import"./spark-md5.2cc5764b.js";import"./axios.e3200588.js";import"./ant-design-vue.5301e143.js";import"./@ant-design.8f7116f5.js";import"./@ctrl.fa7cbd46.js";import"./resize-observer-polyfill.8deb1e21.js";import"./vue-types.6e6d84ba.js";import"./dom-align.f1b5d360.js";import"./lodash-es.8a2ffed6.js";import"./dayjs.38e390ea.js";import"./async-validator.5d25c98b.js";import"./scroll-into-view-if-needed.5191fdbf.js";import"./compute-scroll-into-view.6058b3be.js";import"./js-cookie.31874410.js";/* empty css                     */import"./clipboard.099d05c9.js";import"./markdown-it.20180ffc.js";import"./entities.0d2c0164.js";import"./uc.micro.981ceb7b.js";import"./mdurl.ef76b4dc.js";import"./linkify-it.92c30060.js";import"./markdown-it-emoji.e3e91710.js";import"./escape-html.e5dfadb9.js";import"./prismjs.1971588a.js";import"./diacritics.6be19c75.js";import"./markdown-it-container.512a5043.js";import"./markdown-it-anchor.c88e5394.js";import"./markdown-it-attrs.3af5ab50.js";import"./markdown-it-table-of-contents.8a4ce16f.js";const k={name:"ExForm",inheritAttrs:!1},D=Object.assign(k,{props:{url:String,method:{type:String,default:"POST"},exceptField:{type:Array,default:[]},editId:{type:[String,Number],default:null},callParams:{type:Object,default:{}},params:{type:Object,default:{}},tabsValidateField:{type:Array,default:[]},drawing:Boolean,stepCurrent:[String,Number]},emits:["submit","success","formModalClose","gridRefresh","update:stepCurrent","watchModel"],setup(v,{expose:h,emit:o}){const a=v,l=c(),s=E(),F=S(),p=c(null),{loading:g,http:b}=j();M(s.model,t=>{o("watchModel",t)});function y(){const t=JSON.parse(JSON.stringify(s.model));return A(t,a.exceptField),t}function m(t){let e=t.map(r=>N(r)?"*":r);n.exports.forEach(a.tabsValidateField,function(r){n.exports.forEach(r,function(i,d){e.join(".")==d&&n.exports.forEach(i,function(u){F[u.model]=u.key})})}),l.value.scrollToField(t,{block:"center",behavior:"smooth"})}function C(t,e,r){t=t.join("."),e?(s.validateField[t].message=null,s.validateField[t].status=null):(s.validateField[t].status="error",s.validateField[t].message=r)}function x(){const t=y();o("submit",t),l.value.validate().then(()=>{a.url?b({url:a.url,method:a.method,data:Object.assign(a.callParams,{ex_admin_action:"save",data:t,CURRENT_VALIDATION_STEP:a.stepCurrent,FORM_REF:s.form_ref,id:a.editId},a.params)}).then(e=>{if(e.code===422){let r="";for(let i in e.data){r||(r=i);let d=e.data[i];s.validateField[i].status="error",s.validateField[i].message=Array.isArray(d)?d[0]:d}m([r]);return}else if(e.code===201){o("update:stepCurrent",a.stepCurrent+1);return}else e.code===202&&(o("update:stepCurrent",a.stepCurrent+1),p.value=e.data);o("success",e),o("gridRefresh"),o("formModalClose")}):(o("success"),o("gridRefresh"),o("formModalClose"))}).catch(e=>{m(e.errorFields[0].name)})}function R(){o("update:stepCurrent",0),l.value.resetFields(),p.value=null}return h({stepReset:R,form:l,loading:g,submit:x}),(t,e)=>{const r=f("render"),i=f("a-form");return w(),I(i,V({class:"form",ref_key:"form",ref:l,onValidate:C},t.$attrs),{default:T(()=>[_(t.$slots,"default",{},void 0,!0),P(r,{data:p.value},null,8,["data"]),_(t.$slots,"footer",{},void 0,!0)]),_:3},16)}}});var Ot=O(D,[["__scopeId","data-v-65e905fc"]]);export{Ot as default};
